{% block content %} {% load static %}
<!DOCTYPE html>
<html lang="en">
<div id="wrapper">
  <div id="myScheduler"></div>
</div>

<link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet"></link>
<script src="{% static 'javascript/jquery/jquery-1.10.2.js' %}"></script>
<script src="{% static 'javascript/physicianCalendar.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>
<style>
#choosePatientButton{
  width: 100%;
}
#schedulerEventRecorderForm .popover-title .scheduler-event-recorder-content{
  display: none;
}
</style>
<script>
  //Get patients from service to create the patient dropdown
  var patients = ['Jesus','Dr. Wang', 'Aimee','Revital','Teddy','Kevin'],
  // NOTE: replace with p = User.objects.filter(groups__name='patient')
      i = 0,
      patientsLength = patients.length,
      htmlPatientDropdownString = '<option>Choose Patient</option>';

  for(;i<patientsLength;i++){
    htmlPatientDropdownString += "<option>"+ patients[i] +"</option>";
  }

  var patientDropdown = "<select class=\"custom-select\" id=\"choosePatientButton\">"+htmlPatientDropdownString+"</select>";

  YUI().use(
    'aui-scheduler',
    function(Y) {
      //Pull calendar events
       // $(document).ready( function() {
       //   $.getJSON('?action=pull',function(json){
           // Call service to get calendar data and next appointment details
           // content:
           // endDate:
           // startDate:
           // color: "#8d8",
           // meeting: true,
           // reminder: true,

      var events = [
        {
          // Sample event from AlloyUI bootstrap
          // color: "#8d8",
          // content: $(patientDropdown).children("option").filter(":selected").text(),
          // disabled: true,
          // endDate: new Date(2018, 4, 17, 13),
          // meeting: true,
          // reminder: true,
          // startDate: new Date(2018, 4, 17, 12)
        }
      ];

      var agendaView = new Y.SchedulerAgendaView();
      var dayView = new Y.SchedulerDayView();
      var weekView = new Y.SchedulerWeekView();
      var monthView = new Y.SchedulerMonthView();
      var eventRecorder = new Y.SchedulerEventRecorder({
        on: {
          save: function(event) {
            //   var dataType = 'json',
            //       data =
            //       time =
            //       date =
            //
            //   var requestObject = {
            //     time: time,
            //     date: date,
            //     patient:
            //   };
            //
            //   serviceCall(requestObject);
            //
            //   refresh();
          },
          delete: function(event) {
            //var dataType = 'json',
            //       data =
            //       time =
            //       date =
            //
            //   var requestObject = {
            //     time: time,
            //     date: date,
            //     patient:
            //   };
            //
            //   serviceCall(requestObject);
            //
            //   refresh();
          },
          edit: function(event){
            debugger
          },
          change: function(event){
            debugger
          }
        }
      });

      new Y.Scheduler(
        {
          activeView: weekView,
          boundingBox: '#myScheduler',
          date: new Date(),
          eventRecorder: eventRecorder,
          items: events,
          render: true,
          views: [dayView, weekView, monthView, agendaView],
        }
      );

      Y.Do.after(function() {
        var formFieldToDelete = Y.one('#schedulerEventRecorderForm .popover-title .scheduler-event-recorder-content'),
            formFieldToAppend = Y.one('#schedulerEventRecorderForm .popover-title');
        formFieldToAppend.appendChild(patientDropdown);

        //Disable save button unless selected
        var saveButton = $(".popover-footer button:first");
        saveButton.attr("disabled", "disabled");

        $('#choosePatientButton').change(function(data){
          var chosenPatient = patients[data.target.selectedIndex-1];
          if(chosenPatient === 'Choose Patient'){
            saveButton.attr("disabled", "disabled");
          } else {
            formFieldToDelete._stateProxy.value =  chosenPatient;
            saveButton.removeAttr("disabled");
          }
        });
      }, eventRecorder, 'showPopover');

      Y.Do.after(function() {
        debugger }, eventRecorder, 'getUpdatedSchedulerEvent');


      //TODO: Make a service call after user clicked save/delete.
      //TODO: Make a service call after resizing
      //TODO: Make a service call after dragging the time
    }
  );

  // // Delete an appointment
  // $(document).on('click', '#yui_patched_v3_18_1_1_1524323206273_6697', function(evt){
  //
  // });
  //
  // // Save an appointment
  // $(document).on('click', '#yui_patched_v3_18_1_1_1524348279902_4898', function(evt){

  // });
  //
  //   $(document).ready( function() {
  //     function serviceCall(requestObject){
  //       // Make a service call after saving a new appointment
  //       $.ajax({
  //         url: '',
  //         type: 'POST',
  //         dataType: 'json',
  //         data: requestObject
  //       })
  //     }
  //

</script>

</html>
{% endblock %}
